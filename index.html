<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timesheet Tracker - Mohamed Asad</title>
    <style>
        /* Paste your existing CSS here */
        /* Keep all your previous styles */
    </style>
</head>
<body>
    <div class="container">
        <!-- Keep your existing HTML structure here -->
    </div>

    <!-- Firebase CDN -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js';

        const firebaseConfig = {
          apiKey: "AIzaSyASFl6sgaNqTrbgYk7U1SDQn2m0hjQnZak",
          authDomain: "timesheet-tracker-f542f.firebaseapp.com",
          projectId: "timesheet-tracker-f542f",
          storageBucket: "timesheet-tracker-f542f.firebasestorage.app",
          messagingSenderId: "1063309968048",
          appId: "1:1063309968048:web:7dfe049ca2c9c793e3f175"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const HOURLY_RATE = 14.50;
        const entriesCollection = collection(db, 'entries');

        document.getElementById('dateInput').valueAsDate = new Date();

        let entries = [];

        async function loadEntries() {
            const q = query(entriesCollection, orderBy('date', 'desc'));
            const snapshot = await getDocs(q);
            entries = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
            render();
        }

        async function addEntry() {
            const date = document.getElementById('dateInput').value;
            const start = document.getElementById('startInput').value;
            const end = document.getElementById('endInput').value;

            if (!date || !start || !end) { alert('Bitte alle Felder ausfüllen!'); return; }

            const hours = (new Date(`1970-01-01T${end}`) - new Date(`1970-01-01T${start}`)) / 3600000;
            if (hours <= 0) { alert('Endzeit muss nach Startzeit liegen!'); return; }

            await addDoc(entriesCollection, { date, start, end, hours });

            document.getElementById('startInput').value = '';
            document.getElementById('endInput').value = '';

            await loadEntries();
        }

        async function deleteEntry(id) {
            await deleteDoc(doc(db, 'entries', id));
            await loadEntries();
        }

        async function clearAll() {
            if (!confirm('Wirklich alle Einträge löschen?')) return;
            const snapshot = await getDocs(entriesCollection);
            const deletions = snapshot.docs.map(d => deleteDoc(doc(db, 'entries', d.id)));
            await Promise.all(deletions);
            await loadEntries();
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('de-DE', options);
        }

        function render() {
            const list = document.getElementById('entriesList');
            if (!entries || entries.length === 0) {
                list.innerHTML = `<div class="empty-state">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <p>Noch keine Einträge vorhanden</p>
                    <p style="font-size: 14px; margin-top: 5px;">Füge deine erste Arbeitszeit hinzu!</p>
                </div>`;
            } else {
                list.innerHTML = entries.map(entry => {
                    const amount = entry.hours * HOURLY_RATE;
                    return `<div class="entry-card">
                        <div class="entry-info">
                            <div class="entry-date">${formatDate(entry.date)}</div>
                            <div class="entry-time">${entry.start} - ${entry.end}</div>
                        </div>
                        <div class="entry-hours">${entry.hours.toFixed(2)}h</div>
                        <div class="entry-amount">${amount.toFixed(2)} €</div>
                        <button class="btn btn-delete" onclick="deleteEntry('${entry.id}')">Löschen</button>
                    </div>`;
                }).join('');
            }

            const totalHours = entries.reduce((sum, e) => sum + e.hours, 0);
            const totalAmount = totalHours * HOURLY_RATE;

            document.getElementById('totalHours').textContent = totalHours.toFixed(2) + ' Stunden';
            document.getElementById('totalEntries').textContent = entries.length;
            document.getElementById('totalAmount').textContent = totalAmount.toFixed(2) + ' €';
        }

        loadEntries();
    </script>
</body>
</html>
